exports.view=View={Game:{},Board:{},Move:{}},View.Game.CheckersDrawPieceKing=function(e,t){var i=e[0].getContext("2d"),a=i.canvas.width,s=a/10,r=this.mViewOptions.fullPath+"/res/images/crownwhite.png";i.clearRect(0,0,a,a),i.save(),i.beginPath(),i.fillStyle="rgba(0,0,0,0.5)",i.arc(a/2+s/4,a/2+s/2,(a-s)/2,0,2*Math.PI,!0),i.fill(),i.restore();var o=i.createLinearGradient(0,0,0,a);"white"==t?(o.addColorStop(1,"rgb(204,204,204)"),o.addColorStop(0,"rgb(255,255,255)"),r=this.mViewOptions.fullPath+"/res/images/crownblack.png"):(o.addColorStop(0,"rgb(102,102,102)"),o.addColorStop(1,"rgb(0,0,0)")),i.fillStyle=o,i.beginPath(),i.strokeStyle="rgba(128,128,128,0.8)",i.arc(a/2,a/2,(a-s)/2,0,2*Math.PI,!0),i.fill(),i.stroke(),i.closePath(),i.strokeStyle="rgba(128,128,128,0.3)",i.beginPath(),i.arc(a/2,a/2,(a-s)/2.5,0,2*Math.PI,!0),i.stroke(),i.closePath();var h=new Image,l=a/4;h.onload=function(){i.drawImage(h,l,l,a-2*l,a-2*l)},h.src=r},View.Game.CheckersDrawPiece=function(e,t){var i=e[0].getContext("2d"),a=i.canvas.width,s=a/10;i.clearRect(0,0,a,a),i.save(),i.beginPath(),i.fillStyle="rgba(0,0,0,0.5)",i.arc(a/2+s/4,a/2+s/2,(a-s)/2,0,2*Math.PI,!0),i.fill(),i.restore();var r=i.createLinearGradient(0,0,0,a);"white"==t?(r.addColorStop(1,"rgb(204,204,204)"),r.addColorStop(0,"rgb(255,255,255)")):(r.addColorStop(0,"rgb(102,102,102)"),r.addColorStop(1,"rgb(0,0,0)")),i.fillStyle=r,i.beginPath(),i.strokeStyle="rgba(128,128,128,0.8)",i.arc(a/2,a/2,(a-s)/2,0,2*Math.PI,!0),i.fill(),i.stroke(),i.closePath(),i.beginPath(),i.strokeStyle="rgba(128,128,128,0.3)",i.arc(a/2,a/2,(a-s)/2.5,0,2*Math.PI,!0),i.stroke(),i.closePath(),i.beginPath(),i.arc(a/2,a/2,(a-s)/8,0,2*Math.PI,!0),i.stroke(),i.closePath()},View.Game.CheckersDrawPieceBitmap=function(e,t){var i=e[0].getContext("2d"),a=i.canvas.width;i.clearRect(0,0,a,a),i.drawImage(this.g.piecesRes,t,0,200,200,0,0,a-0,a-0)},View.Game.CheckersDrawPieceKingHalloween=function(e,t){this.CheckersDrawPieceBitmap(e,"white"==t?400:600)},View.Game.CheckersDrawPieceHalloween=function(e,t){this.CheckersDrawPieceBitmap(e,"white"==t?0:200)},View.Game.CheckersDrawBoard=function(){},View.Game.CheckersDrawCell=function(e,t,i,a,s,r){},View.Game.CheckersSetCellSide=function(){var e=this.mOptions.width,t=this.mOptions.height,i=Math.min(this.mGeometry.width/(e+1),this.mGeometry.height/(t+1))-1;this.g.cellSide=i},View.Game.CheckersSetBoardSize=function(){var e=this.mOptions.width,t=this.mOptions.height;this.g.boardW=this.g.cellSide*e,this.g.boardH=this.g.cellSide*t},View.Game.CheckersGetCellPosition=function(e,t){return{top:this.g.top+e*this.g.cellSide,left:this.g.left+t*this.g.cellSide}},View.Game.CheckersMarginFactor=16,View.Game.CheckersPossibleMarginFactor=-4,View.Game.InitView=function(){function e(e,i){var a;switch(e){case JocGame.PLAYER_A:a="piece-white";break;case JocGame.PLAYER_B:a="piece-black"}var s=$("<div/>").addClass("piece").addClass(a).css({width:h.g.cellSide-2*h.g.cellMargin,height:h.g.cellSide-2*h.g.cellMargin,"border-radius":Math.floor((h.g.cellSide-2*h.g.cellMargin)/2)}).hide();s.attr("jocindex",i),s.attr("joctype",0),s.appendTo(h.mWidget);var r=$("<canvas/>").addClass("piece-canvas").attr("width",h.g.cellSide-2*h.g.cellMargin).attr("height",h.g.cellSide-2*h.g.cellMargin);r.appendTo(s),"halloween"==t.mSkin?t.CheckersDrawPieceHalloween(r,1==e&&t.g.whiteStarts||e==-1&&0==t.g.whiteStarts?"white":"black"):t.CheckersDrawPiece(r,1==e&&t.g.whiteStarts||e==-1&&0==t.g.whiteStarts?"white":"black")}var t=this,i=this.mOptions.width,a=this.mOptions.height,s=this.mOptions.initial;this.CheckersSetCellSide(),this.g.cellMargin=Math.floor(this.g.cellSide/this.CheckersMarginFactor),this.g.tokenSide=this.g.cellSide-2*this.g.cellMargin,this.CheckersSetBoardSize(),this.g.top=Math.floor((this.mGeometry.height-this.g.boardH)/2),this.g.left=Math.floor((this.mGeometry.width-this.g.boardW)/2),"halloween"==this.mSkin&&(this.g.piecesRes=this.preloadedImages.pieces);var r=$("<div/>").addClass("checkersbase-board").css({top:this.g.top,left:this.g.left,width:this.g.boardW,height:this.g.boardH}).appendTo(this.mWidget),o=$("<canvas/>").attr("width",this.g.boardW).attr("height",this.g.boardH).appendTo(r);this.g.ctxField=o[0].getContext("2d"),this.g.ctxField.clearRect(0,0,this.g.boardW,this.g.boardH),this.g.ctxField.save(),this.CheckersDrawBoard(),this.g.ctxField.restore();var h=this,l=0;for(var c in s.a)s.a.hasOwnProperty(c)&&e(JocGame.PLAYER_A,l++);for(var c in s.b)s.b.hasOwnProperty(c)&&e(JocGame.PLAYER_B,l++);for(var c=0;c<this.g.Coord.length;c++){var n=this.g.Coord[c],d=n[0],g=n[1];h.mViewAs==JocGame.PLAYER_A?d=a-d-1:g=i-g-1;var p=this.CheckersGetCellPosition(d,g);if(this.mShowMoves){var m=$("<div/>").addClass("possible").css({width:this.g.cellSide-this.CheckersPossibleMarginFactor*h.g.cellMargin,height:this.g.cellSide-this.CheckersPossibleMarginFactor*h.g.cellMargin,"border-radius":Math.floor((h.g.cellSide-this.CheckersPossibleMarginFactor*h.g.cellMargin)/2),top:p.top+this.CheckersPossibleMarginFactor*this.g.cellMargin/2,left:p.left+this.CheckersPossibleMarginFactor*this.g.cellMargin/2}).hide();m.attr("jocpos",c),m.appendTo(h.mWidget)}var w=$("<div/>").addClass("front").css({width:this.g.cellSide,height:this.g.cellSide,top:p.top,left:p.left});if(w.attr("jocpos",c),w.appendTo(h.mWidget),this.CheckersDrawCell(d,g,p.top,p.left,this.g.cellSide,this.g.cellSide),this.mNotation){var f=this.g.cellSide/8;$("<div/>").text(parseInt(c)+1).addClass("notation").css({"line-height":f+"px","font-size":f+"pt",top:p.top,left:p.left,"text-shadow":"0px "+f/10+"px "+f/15+"px#000"}).appendTo(this.mWidget)}}},View.Board.Display=function(e){for(var t=e.mOptions.width,i=e.mOptions.height,a=0;a<this.pieces.length;a++){var s=this.pieces[a];if(null!=s){var r=e.mWidget.find(".piece[jocindex="+a+"]"),o=s.s;if(parseInt(r.attr("joctype"))!=s.t){r.attr("joctype",s.t);var h=r.find("canvas");switch(s.t){case 0:"halloween"==e.mSkin?e.CheckersDrawPieceHalloween(h,1==o&&e.g.whiteStarts||o==-1&&0==e.g.whiteStarts?"white":"black"):e.CheckersDrawPiece(h,1==o&&e.g.whiteStarts||o==-1&&0==e.g.whiteStarts?"white":"black");break;case 1:"halloween"==e.mSkin?e.CheckersDrawPieceKingHalloween(h,1==o&&e.g.whiteStarts||o==-1&&0==e.g.whiteStarts?"white":"black"):e.CheckersDrawPieceKing(h,1==o&&e.g.whiteStarts||o==-1&&0==e.g.whiteStarts?"white":"black")}}var l=e.g.Coord[s.p],c=l[0],n=l[1];e.mViewAs==JocGame.PLAYER_A?c=i-c-1:n=t-n-1;var d=e.CheckersGetCellPosition(c,n);r.css({top:d.top+e.g.cellMargin,left:d.left+e.g.cellMargin}).show()}else e.mWidget.find(".piece[jocindex="+a+"]").hide()}},View.Board.UpdateZIndex=function(e){$(".piece-white").css("z-index",this.mWho==JocGame.PLAYER_A?101:100),$(".piece-black").css("z-index",this.mWho==JocGame.PLAYER_A?100:101)},View.Board.PlayedMove=function(e,t){function i(r){var h=e.g.Coord[t.pos[r]],l=h[0],c=h[1];e.mViewAs==JocGame.PLAYER_A?l=s-l-1:c=a-c-1;var n=e.CheckersGetCellPosition(l,c);o.animate({top:n.top+e.g.cellMargin,left:n.left+e.g.cellMargin},500,function(){r++,r>=t.pos.length?e.MoveShown():i(r)})}this.UpdateZIndex(e);var a=e.mOptions.width,s=e.mOptions.height,r=this.board[t.pos[t.pos.length-1]],o=e.mWidget.find(".piece[jocindex="+r+"]");return i(1),!1},View.Board.HumanTurn=function(e){function t(t){var i=e.g.Coord[t],o=i[0],h=i[1];e.mViewAs==JocGame.PLAYER_A?o=r-o-1:h=s-h-1;var l=e.CheckersGetCellPosition(o,h);a.animate({top:l.top+e.g.cellMargin,left:l.left+e.g.cellMargin},500,function(){})}function i(){e.mWidget.find(".possible").hide(),e.mWidget.find(".front").unbind(JocGame.CLICK).removeClass("choice back"),l.length>0&&e.mWidget.find(".front[jocpos="+l[l.length-1]+"]").addClass("back").bind(JocGame.CLICK,function(){t(l[0]),h=0,l=[],c=[],i()});for(var s=[],r=0;r<o.length;r++){for(var d=o[r],g=!0,p=0;p<l.length;p++)if(l[p]!=d.pos[p]){g=!1;break}g&&s.push(d)}for(var m={},w={},r=0;r<s.length;r++){var d=s[r];m[d.pos[h]]=!0,w[d.pos[h]]=d.capt[h]}for(var f in m)m.hasOwnProperty(f)&&(e.mWidget.find(".possible[jocpos="+f+"]").show(),e.mWidget.find(".front[jocpos="+f+"]").addClass("choice").bind(JocGame.CLICK,function(){var s=parseInt($(this).attr("jocpos"));l.push(s),c.push(w[f]),0==h?a=e.mWidget.find(".piece[jocindex="+n.board[s]+"]"):t(s),h++,i()}));1==s.length&&s[0].pos.length==l.length&&(e.mWidget.find(".front").removeClass("back"),setTimeout(function(){e.MakeMove(JSON.parse(JSON.stringify(s[0])))},500))}this.UpdateZIndex(e);var a,s=e.mOptions.width,r=e.mOptions.height,o=this.mMoves,h=0,l=[],c=[],n=this;i()},View.Board.HumanTurnEnd=function(e){e.mWidget.find(".possible").hide(),e.mWidget.find(".front").unbind(JocGame.CLICK).removeClass("choice back")},View.Game.CheckersDrawBoard=function(){var e=(this.mOptions.width,this.mOptions.height),t="",i=this;switch(this.mSkin){default:break;case"halloween":8==e&&(t=this.mViewOptions.fullPath+"/res/images/damier8x8halloween.jpg"),10==e&&(t=this.mViewOptions.fullPath+"/res/images/damier10x10wood.jpg");break;case"wood0":8==e&&(t=this.mViewOptions.fullPath+"/res/images/damier8x8wood.jpg"),10==e&&(t=this.mViewOptions.fullPath+"/res/images/damier10x10wood.jpg");break;case"marble0":8==e&&(t=this.mViewOptions.fullPath+"/res/images/damier8x8marble.jpg"),10==e&&(t=this.mViewOptions.fullPath+"/res/images/damier10x10marble.jpg");break;case"classical":8==e&&(t=this.mViewOptions.fullPath+"/res/images/damier8x8classic.jpg"),10==e&&(t=this.mViewOptions.fullPath+"/res/images/damier10x10classic.jpg")}if(t.length>0){var a=new Image;a.onload=function(){i.g.ctxField.drawImage(a,0,0,i.g.boardW,i.g.boardH)},a.src=t}else{var s=this.g.ctxField.createRadialGradient(-this.g.boardW/2,-this.g.boardW/2,0,this.g.boardW/6*4,this.g.boardW/6*2,2*this.g.boardW);s.addColorStop(0,"#BAF445"),s.addColorStop(1,"#008000"),this.g.ctxField.fillStyle=s,this.g.ctxField.beginPath(),this.g.ctxField.rect(0,0,this.g.boardW,this.g.boardH),this.g.ctxField.closePath(),this.g.ctxField.fill()}},View.Game.CheckersSetBoardSize=function(){var e=this.mOptions.width,t=this.mOptions.height;this.g.boardW=this.g.cellSide*e*2,this.g.boardH=this.g.cellSide*t},View.Game.CheckersGetCellPosition=function(e,t){return{top:this.g.top+e*this.g.cellSide,left:this.g.left+(2*t+(1-e%2))*this.g.cellSide}},View.Game.CheckersDrawCell=function(e,t,i,a,s,r){var o=$("<div/>").addClass("cell").css({top:i,left:a,width:s,height:r}).attr("joclypos",e+" "+t).appendTo(this.mWidget);"green"==this.mSkin&&o.addClass("cell-black")};