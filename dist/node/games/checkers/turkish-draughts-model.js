exports.model=Model={Game:{},Board:{},Move:{}},function(){function t(t){if(o){var e=t%i;return(t-e)/i*i+i-e}var r=i*s-t-1,n=r%i;return r-n+i-n}var i,s,o=!1;Model.Game.checkersPosToString=t,Model.Game.InitGameInfo=function(){},Model.Game.BuildGraphCoord=function(){var t=(this.mOptions.width,this.mOptions.height,[]),i=[];this.g.Graph=t,this.g.Coord=i},Model.Game.InitGame=function(){var t=this.mOptions.width,e=this.mOptions.height;if(i=t,s=e,o=this.mOptions.invertNotation||!1,this.g.compulsoryCatch=!0,this.g.canStepBack=!0,this.g.mustMoveForward=!1,this.g.mustMoveForwardStrict=!1,this.g.lastRowFreeze=!1,this.g.lastRowCrown=!1,this.g.captureLongestLine=!1,this.g.noMove="lose",this.g.kingCaptureShort=!1,this.g.kingValue=5,this.g.lastRowFactor=0,this.g.canCaptureBackward=!0,this.g.captureInstantRemove=!1,this.g.longRangeKing=!0,this.g.drawKvsK=!0,this.g.drawKvs2K=!0,this.g.whiteStarts=!0,this.g.king180deg=!1,this.mOptions.variant)for(var r in this.mOptions.variant)this.g[r]=this.mOptions.variant[r];this.BuildGraphCoord(),this.zobrist=new JocGame.Zobrist({board:{type:"array",size:this.g.Graph.length,values:["1/0","1/1","-1/0","-1/1"]}})},Model.Game.DestroyGame=function(){},Model.Game.CheckersDirections=4,Model.Game.Checkers2WaysDirections=[0,1,1,0],Model.Game.CheckersEachDirection=function(t,i){for(var s=0;s<this.CheckersDirections;s++){var o=this.g.Graph[t][s];if(null!=o&&0==i(o,s))return}},Model.Move.Init=function(t){this.pos=[];for(var i in t.pos)this.pos.push(t.pos[i]);this.capt=[];for(var i in t.capt)this.capt.push(t.capt[i])},Model.Move.ToString=function(){for(var i=[t(this.pos[0]),t(this.pos[this.pos.length-1])],s="-",o=1;o<this.capt.length;o++)null!=this.capt[o]&&(s="x",this.capt.length>3&&i.push(t(this.capt[o])));return i.join(s)},Model.Board.Init=function(t){this.zSign=0},Model.Board.InitialPosition=function(t){var i=t.mOptions.width,s=t.mOptions.height,o=t.mOptions.initial;this.board=[];for(var e=0;e<s;e++)for(var r=0;r<i;r++)this.board[e*i+r]=-1;this.pieces=[];var n=0;if(t.mInitial){this.pCount=[0,0],this.spCount=[0,0],this.kpCount=[0,0];for(var a=0;a<t.mInitial.pieces.length;a++){var h=t.mInitial.pieces[a];this.board[h.p]=a,this.pieces.push({s:h.s,p:h.p,l:-1,t:h.t,plp:h.p}),this.zSign=t.zobrist.update(this.zSign,"board",h.s+"/"+h.t,h.p);var p=-(h.s-1)/2;this.pCount[p]++,0==h.t?this.spCount[p]++:this.kpCount[p]++}}else{for(var a in o.a){var u=o.a[a],c=u[0]*i+u[1],h={s:JocGame.PLAYER_A,p:c,l:-1,t:0,plp:c};this.pieces.push(h),this.board[c]=n++,this.zSign=t.zobrist.update(this.zSign,"board","1/0",c)}for(var a in o.b){var u=o.b[a],c=u[0]*i+u[1],h={s:JocGame.PLAYER_B,p:c,l:-1,t:0,plp:c};this.pieces.push(h),this.board[c]=n++,this.zSign=t.zobrist.update(this.zSign,"board","-1/0",c)}this.pCount=[o.a.length,o.b.length],this.spCount=[o.a.length,o.b.length],this.kpCount=[o.a.length,o.b.length]}},Model.Board.GenerateMoves=function(t){try{this._GenerateMoves(t)}catch(t){}},Model.Board._GenerateMoves=function(t){function i(t){for(var i in e.pieces){var s=e.pieces[i];s&&s.s==e.mWho&&t(i,s.p)}}function s(i,o,r,n,a){for(;;){var h=[],p=[],u=[];if(t.CheckersEachDirection(i,function(s,c){var g;0==t.g.canCaptureBackward&&(g=t.g.Coord[i][0]);var l=t.Checkers2WaysDirections[c];if(a){if(t.g.longRangeKing)for(;e.board[s]==-1||t.g.king180deg&&null!=s&&r.indexOf(s)>=0;)s=t.g.Graph[s][c];if(null!=s&&e.board[s]>=0&&e.pieces[e.board[s]].s==-e.mWho){var v=s;if(s=t.g.Graph[s][c],t.g.kingCaptureShort){if(e.board[s]==-1||s==o[0]){for(var d=!0,m=0;m<n.length;m++)if(t.g.king180deg){if(r[m]==v){d=!1;break}}else if(t.g.captureInstantRemove&&r[m]==v||0==t.g.captureInstantRemove&&r[m]==v&&n[m]==l){d=!1;break}d&&(h.push(s),p.push(v),u.push(l)),s=t.g.Graph[s][c]}}else for(;e.board[s]==-1||s==o[0];){for(var d=!0,m=0;m<n.length;m++)if(t.g.captureInstantRemove&&r[m]==v||0==t.g.captureInstantRemove&&r[m]==v&&n[m]==l){d=!1;break}d&&(h.push(s),p.push(v),u.push(l)),s=t.g.Graph[s][c]}}}else if(e.board[s]>=0&&e.pieces[e.board[s]].s==-e.mWho){var f,C;if(0==t.g.canCaptureBackward&&(f=t.g.Coord[s][0],C=!1,(e.mWho==JocGame.PLAYER_A&&f>=g||e.mWho==JocGame.PLAYER_B&&f<=g)&&(C=!0)),t.g.canCaptureBackward||1==C){var b=t.g.Graph[s][c];if(null!=b&&(e.board[b]==-1||b==o[0])){for(var d=!0,m=0;m<n.length;m++)if(t.g.captureInstantRemove&&r[m]==s||0==t.g.captureInstantRemove&&r[m]==s&&n[m]==l){d=!1;break}d&&(h.push(b),p.push(s),u.push(l))}}}return!0}),0==h.length){o.length>1&&e.mMoves.push({pos:o,capt:r});break}if(!t.g.compulsoryCatch&&o.length>1){for(var c=[],g=0;g<o.length;g++)c.push(o[g]);for(var l=[],g=0;g<r.length;g++)l.push(r[g]);e.mMoves.push({pos:c,capt:l})}if(1!=h.length){for(var g=0;g<h.length;g++){for(var c=[],v=0;v<o.length;v++)c.push(o[v]);c.push(h[g]);for(var l=[],v=0;v<r.length;v++)l.push(r[v]);l.push(p[g]);for(var d=[],v=0;v<n.length;v++)d.push(n[v]);d.push(u[g]),s(h[g],c,l,d,a)}break}i=h[0],o.push(i),r.push(p[0]),n.push(u[0])}}var o=t.mOptions.height,e=this;if(this.mMoves=[],i(function(t,i){0==e.pieces[t].t?s(i,[i],[null],[null],!1):1==e.pieces[t].t&&s(i,[i],[null],[null],!0)}),0!=t.g.compulsoryCatch&&0!=this.mMoves.length||i(function(i,s){var r;0==e.pieces[i].t?((t.g.mustMoveForward||t.g.mustMoveForwardStrict||t.lastRowFreeze)&&(r=t.g.Coord[s][0]),t.CheckersEachDirection(s,function(n,a){var h,p,u;return t.g.mustMoveForwardStrict?(h=t.g.Coord[n][0],p=!1,(e.mWho==JocGame.PLAYER_A&&h>r||e.mWho==JocGame.PLAYER_B&&h<r)&&(p=!0)):t.g.mustMoveForward&&(h=t.g.Coord[n][0],p=!0,(e.mWho==JocGame.PLAYER_A&&h<r||e.mWho==JocGame.PLAYER_B&&h>r)&&(p=!1)),t.g.lastRowFreeze&&(u=!1,(e.mWho==JocGame.PLAYER_A&&r==o-1||e.mWho==JocGame.PLAYER_B&&0==r)&&(u=!0)),e.board[n]!=-1||!t.g.canStepBack&&n==e.pieces[i].l||(0!=t.g.mustMoveForward||0!=t.g.mustMoveForwardStrict)&&1!=p||0!=t.g.lastRowFreeze&&0!=u||e.mMoves.push({pos:[s,n],capt:[null,null]}),!0})):1==e.pieces[i].t&&t.CheckersEachDirection(s,function(i,o){if(t.g.longRangeKing)for(;e.board[i]==-1;)e.mMoves.push({pos:[s,i],capt:[null,null]}),i=t.g.Graph[i][o];else e.board[i]==-1&&(e.mMoves.push({pos:[s,i],capt:[null,null]}),i=t.g.Graph[i][o]);return!0})}),0==this.mMoves.length)switch(t.g.noMove){case"count":this.mFinished=!0,this.pCount[0]<this.pCount[1]?this.mWinner=JocGame.PLAYER_B:this.pCount[1]<this.pCount[0]?this.mWinner=JocGame.PLAYER_A:this.mWinner=JocGame.DRAW;break;case"lose":this.mFinished=!0,this.mWinner=-this.mWho;break;default:this.mFinished=!0,this.mWinner=JocGame.DRAW}if(t.g.captureLongestLine){var r=this.mMoves,n=[],a=0;for(var h in r){var p=r[h];p.pos.length==a?n.push(p):p.pos.length>a&&(n=[p],a=p.pos.length)}this.mMoves=n}},Model.Board.Evaluate=function(t,i,s){if(t.mOptions.preventRepeat&&t.GetRepeatOccurence(this)>2)return this.mFinished=!0,void(this.mWinner=JocGame.DRAW);if(t.g.drawKvsK&&0==this.spCount[0]&&0==this.spCount[1]&&1==this.kpCount[0]&&1==this.kpCount[1])return this.mFinished=!0,void(this.mWinner=JocGame.DRAW);if(t.g.drawKvs2K&&0==this.spCount[0]&&0==this.spCount[1]&&this.kpCount[0]+this.kpCount[1]==3&&(1==this.kpCount[0]||2==this.kpCount[0]))return this.mFinished=!0,void(this.mWinner=JocGame.DRAW);if(0==this.pCount[1])return this.mFinished=!0,void(this.mWinner=JocGame.PLAYER_A);if(0==this.pCount[0])return this.mFinished=!0,void(this.mWinner=JocGame.PLAYER_B);if(this.mEvaluation=10*(this.spCount[0]-this.spCount[1])+10*(this.kpCount[0]-this.kpCount[1])*t.g.kingValue+this.pCount[0]/this.pCount[1]-this.pCount[1]/this.pCount[0],0!=t.g.lastRowFactor){var o=t.mOptions.height,e=0,r=0;for(var n in this.pieces){var a=this.pieces[n];a&&0==a.t&&(this.mWho==JocGame.PLAYER_A?e+=t.g.Coord[a.p][0]:r+=o-1-t.g.Coord[a.p][0])}this.mEvaluation+=(e-r)*t.g.lastRowFactor}},Model.Board.CopyFrom=function(t){this.board=[];for(var i=0;i<t.board.length;i++)this.board[i]=t.board[i];this.pieces=[];for(var i=0;i<t.pieces.length;i++){var s=t.pieces[i];this.pieces[i]=null==s?null:{s:s.s,p:s.p,l:s.l,t:s.t,plp:s.plp}}this.pCount=[t.pCount[0],t.pCount[1]],this.spCount=[t.spCount[0],t.spCount[1]],this.kpCount=[t.kpCount[0],t.kpCount[1]],this.mWho=t.mWho,this.zSign=t.zSign},Model.Board.ApplyMove=function(t,i){var s=(t.mOptions.width,t.mOptions.height),o=i.pos[0],e=this.board[o],r=this.pieces[e],n=r.s;r.l=o;var a={};this.zSign=t.zobrist.update(this.zSign,"board",r.s+"/"+r.t,r.p);for(var h=1;h<i.pos.length;h++){var p=i.pos[h];this.board[r.p]=-1,r.p=p,this.board[p]=e;var u=i.capt[h];null!=u&&(this.board[u]>=0&&(a[this.board[u]]=!0),this.board[u]=-1),o=p}this.zSign=t.zobrist.update(this.zSign,"board",r.s+"/"+r.t,p);var c=i.capt[i.capt.length-1];r.plp=c||i.pos[i.pos.length-2];for(var g in a){var l=this.pieces[g],v=(1-l.s)/2;switch(this.pCount[v]--,l.t){case 0:this.spCount[v]--;break;case 1:this.kpCount[v]--}this.zSign=t.zobrist.update(this.zSign,"board",l.s+"/"+l.t,l.p),this.pieces[g]=null}if(t.g.lastRowCrown&&0==this.pieces[e].t){var d=t.g.Coord[i.pos[i.pos.length-1]][0];if(n==JocGame.PLAYER_A&&d==s-1||n==JocGame.PLAYER_B&&0==d){var l=this.pieces[e];l.t=1;var m=(1-n)/2;this.spCount[m]--,this.kpCount[m]++,this.zSign=t.zobrist.update(this.zSign,"board",l.s+"/0",l.p),this.zSign=t.zobrist.update(this.zSign,"board",l.s+"/1",l.p)}}},Model.Board.IsValidMove=function(t,i){return!0},Model.Board.GetSignature=function(){return this.zSign},Model.Game.Import=function(t,i){function s(t,i,s){s=r-s;var o=s%n;s=s-o+n-o-1,e.push({s:t,p:s,l:-1,t:i,plp:s})}var o=1,e=[],r=this.mOptions.width*this.mOptions.height,n=this.mOptions.width;if("pjn"==t){var a=i.split(":");o="W"==a[0]?1:-1;for(var h=1;h<a.length;h++)if(0!=a[h].length)for(var p="W"==a[h].substr(0,1)?1:-1,u=a[h].substr(1).split(","),c=0;c<u.length;c++){var g=u[c],l=0;"K"==g.substr(0,1)&&(l=1,g=g.substr(1));var v=/^([0-9]+)-([0-9]+)$/.exec(g);if(v)for(var d=parseInt(v[1]);d<=parseInt(v[2]);d++)s(p,l,d);else s(p,l,parseInt(g))}return e.sort(function(t,i){return i.s-t.s}),{status:!0,initial:{pieces:e,turn:o}}}return{status:!1,error:"unsupported"}};var e=JocGame.prototype.GetBestMatchingMove;Model.Game.GetBestMatchingMove=function(t,i){var s=[];i.forEach(function(t){s.push(t.ToString())}),t=t.replace(/0([1-9])/g,"$1");var o=/^([0-9]+)[\-x]([0-9]+)([\-x][0-9]+)*$/.exec(t);if(o){var r=new RegExp("^"+o[1]+"[-x]"+o[2]+"([-x][0-9]+)*$"),n={};i.forEach(function(t,i){if(r.test(s[i])){var o=s[i],e=/^([0-9]+)x([0-9]+)x([0-9]+(x[0-9]+)*)/.exec(o);if(e){var a=e[3].split("x");a.sort(function(t,i){return parseInt(t)-parseInt(i)}),o=e[1]+"x"+e[2]+"x"+a.join("x")}n[o]=t}});var a=[];for(var h in n)a.push(n[h]);a.length>0&&(i=a)}return e.call(this,t,i)},Model.Board.ExportBoardState=function(i){var s={},o=[];this.pieces.forEach(function(i){if(i&&null!=i.p){var o=1==i.s?"W":"B";void 0===s[o]&&(s[o]={});var e=1==i.t?"K":"";void 0===s[o][e]&&(s[o][e]={group:0==i.t,pos:[]}),s[o][e].pos.push(parseInt(t(i.p)))}});for(var e in s){var r=[];for(var n in s[e]){var a=s[e][n];if(a.group){a.pos.sort(function(t,i){return parseInt(t)-parseInt(i)});var h=-2,p=-1,u=-1;a.pos.forEach(function(t){parseInt(t)==h+1?p=t:(p>=0?(r.push(n+u+"-"+p),p=-1):u>=0&&r.push(n+u),u=t),h=parseInt(t)}),p>=0?r.push(n+u+"-"+p):u>=0&&r.push(n+u)}else a.pos.forEach(function(t){r.push(n+t)})}o.push(e+r.join(","))}return o.join(":")}}(),Model.Game.CheckersDirections=8,Model.Game.Checkers2WaysDirections=[0,1,2,3,3,2,1,0],Model.Game.BuildGraphCoord=function(){for(var t=this.mOptions.width,i=this.mOptions.height,s=[],o=[],e=0;e<i;e++)for(var r=0;r<t;r++){var n=e*t+r;o[n]=[e,r],s[n]=[];for(var a=-1;a<2;a++)for(var h=-1;h<2;h++)0==a&&0==h||(e+a<i&&e+a>=0&&r+h<t&&r+h>=0&&Math.abs(a)!=Math.abs(h)?s[n].push((e+a)*t+r+h):s[n].push(null))}this.g.Graph=s,this.g.Coord=o};