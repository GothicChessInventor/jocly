"use strict";function GameProxyClass(e){this.gameName=e,this.listeners=[]}function Post(e,n){e.listeners.forEach(function(t){t.call(e,n)})}function GetListener(e){return function(n){var t=this;switch(n.type){case"human-move":t.ApplyMove(n.move);var r=t.GetFinished();r||t.InvertWho(),Object.assign(n,{finished:!!r,winner:r});break;case"machine-move":var o=n.result.move;delete n.result.move,t.ApplyMove(o);var r=t.GetFinished();return r||t.InvertWho(),void Post(e,{type:"machine-move",moveData:n.result,move:o,finished:!!r,winner:r})}Post(e,n)}}function CreateGame(e){return new Promise(function(n,t){function r(r){var o=new GameProxyClass(e);Object.assign(o,r),o.game=new joclyCore.createInternalGame(e).then(function(e){e.AddListener(GetListener(o)),o.game=e,n(o)},t)}var o=gameConfigs[e];o?r(o):joclyCore.listGames().then(function(n){var o=n[e];if(!o)return t(new Error("Game "+e+" not found"));var i=require("./games/"+o.module+"/"+e+"-config.js");gameConfigs[e]=i,r(i)},t)})}var joclyGame=require("./jocly.game"),joclyCore=require("./jocly.core"),gameConfigs={};GameProxyClass.prototype.listen=function(e){var n=this;return new Promise(function(t,r){n.listeners.push(e),t()})},GameProxyClass.prototype.unlisten=function(e){var n=this;return new Promise(function(t,r){for(var o=n.listeners.length-1;o>=0;o--)n.listeners[o]==e&&n.listeners.splice(o,1);t()})},GameProxyClass.prototype.humanTurn=function(){return this.game.humanTurn()},GameProxyClass.prototype.machineTurn=function(e){var n=this;return new Promise(function(t,r){n.game.StartMachine(e),t()})},GameProxyClass.prototype.getFinished=function(){var e=this;return new Promise(function(n,t){n(e.gameName.GetFinished())})},GameProxyClass.prototype.getMoveString=function(e){var n=this;return new Promise(function(t,r){t(new(n.game.GetMoveClass())(e).ToString())})},exports.createGame=CreateGame;